<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vlog-Orte</title>

  <meta name="theme-color" content="#111111" />
  <link rel="manifest" href="manifest.json">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

  <style>
    :root { color-scheme: dark; }
    body{
      margin:0; font-family: system-ui, Arial;
      background:#0f0f10; color:#eaeaea;
    }
    header{
      padding:12px 14px;
      border-bottom:1px solid #2a2a2a;
      background:#0f0f10;
      position:sticky; top:0; z-index:10;
    }
    .wrap{ padding:12px 14px; display:grid; gap:12px; }
    .card{
      background:#151517; border:1px solid #2a2a2a;
      border-radius:18px; padding:12px; box-shadow: 0 8px 20px rgba(0,0,0,.25);
    }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .row > * { flex: 0 0 auto; }
    button, select, input, textarea{
      background:#1b1b1d; border:1px solid #2f2f33; color:#eaeaea;
      padding:10px 12px; border-radius:12px; font-size:15px;
    }
    button{ cursor:pointer; }
    button:disabled{ opacity:.45; cursor:not-allowed; }
    .muted{ color:#b8b8b8; }
    .small{ font-size:13px; color:#b8b8b8; }
    #map{
      height:220px; border-radius:18px;
      border:1px solid #2a2a2a; overflow:hidden;
    }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:6px 10px; border-radius:999px;
      border:1px solid #2a2a2a; background:#111113; font-size:13px;
    }
    textarea{
      width:100%; min-height:140px; resize:vertical;
      line-height:1.35;
    }
    .sep{ height:1px; background:#2a2a2a; margin:10px 0; }
    .danger{ color:#ffb3b3; }
    a{ color:#9fd0ff; text-decoration:none; }
    a:hover{ text-decoration:underline; }
    .two{ display:grid; gap:12px; }
    @media (min-width: 780px){
      .two{ grid-template-columns: 1.1fr .9fr; }
      #map{ height:360px; }
    }
    #debugBox{
      white-space:pre-wrap;
      background:#0f0f10; border:1px dashed #2a2a2a;
      border-radius:12px; padding:10px; font-size:12px;
      max-height:160px; overflow:auto;
      display:none;
    }
  </style>
</head>

<body>
  <header>
    <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
      <div>
        <div style="font-weight:800; font-size:18px;">Vlog-Orte</div>
        <div class="small" id="statusLine">bereit</div>
      </div>
      <div class="row">
        <button id="btnDebug">Debug</button>
      </div>
    </div>
  </header>

  <div class="wrap two">
    <div class="card">
      <div id="map"></div>

      <div class="sep"></div>

      <div class="row">
        <button id="btnStart">Tracking starten</button>
        <button id="btnStop" disabled>Stop</button>
        <button id="btnInfo">Infos hier holen</button>
        <button id="btnNow">Standort jetzt holen</button>
      </div>

      <div style="margin-top:10px; display:grid; gap:8px;">
        <div class="pill">GPS: <span id="gpsLine" class="muted">‚Äî</span></div>
        <div class="small">
          Tipp: In Android/Chrome muss die Standortfreigabe f√ºr die Seite erlaubt sein.
          Wenn‚Äôs nicht geht: Browser-Einstellungen ‚Üí Website-Einstellungen ‚Üí Standort ‚Üí Erlauben.
        </div>
      </div>

      <div id="debugBox" class="small" style="margin-top:10px;"></div>
    </div>

    <div class="card">
      <div style="font-weight:800; font-size:18px;">Ort-Infos</div>
      <div class="muted" id="infoIntro" style="margin-top:6px;">
        Noch keine Infos geladen.
      </div>

      <div class="sep"></div>

      <div id="infoBox" class="small">
        Starte das Tracking oder dr√ºck ‚ÄûStandort jetzt holen‚Äú.
      </div>

      <div class="row" style="margin-top:10px;">
        <span class="pill">Wikipedia: <span id="wikiLink" class="muted">‚Äî</span></span>
      </div>

      <div class="sep"></div>

      <div class="row">
        <button id="btnScript">Vlog-Skript</button>
        <select id="lenSel">
          <option value="30">30 Sekunden</option>
          <option value="60">60 Sekunden</option>
        </select>
        <button id="btnHook">Hook wechseln</button>
      </div>

      <div class="row" style="margin-top:10px;">
        <button id="btnCopy">Skript kopieren</button>
        <button id="btnSaveSpot">Ort speichern</button>
      </div>

      <div style="margin-top:10px;">
        <textarea id="scriptBox" placeholder="Hier erscheint dein fertiges Vlog-Skript (30/60 Sekunden)‚Ä¶"></textarea>
        <div class="small" style="margin-top:8px;">
          Hinweis: Wikipedia-Infos sind eine gute Basis, aber f√ºr heikle Details kurz gegenchecken (Infotafel/Museum/Offizielles).
        </div>
      </div>
    </div>

    <div class="card" style="grid-column:1 / -1;">
      <div style="font-weight:800; font-size:18px;">Gespeicherte Orte</div>
      <div class="small muted">Wird lokal auf deinem Handy gespeichert (kein Server).</div>
      <div class="sep"></div>
      <div id="visitsBox" class="small muted">Noch nichts gespeichert.</div>
      <div class="row" style="margin-top:10px;">
        <button id="btnClear">Alle l√∂schen</button>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    /* ===================== Helpers ===================== */
const $ = (id) => document.getElementById(id);

function setStatus(text, kind){
  $("statusLine").textContent = text;
  if(kind==="ok") $("statusLine").style.color = "#b8ffca";
  else if(kind==="warn") $("statusLine").style.color = "#ffe2a6";
  else if(kind==="bad") $("statusLine").style.color = "#ffb3b3";
  else $("statusLine").style.color = "#b8b8b8";
}

let debugOn = false;
function clearDebug(){ $("debugBox").textContent = ""; }
function logDebug(msg){
  if(!debugOn) return;
  const box = $("debugBox");
  box.textContent += msg + "\n";
  box.scrollTop = box.scrollHeight;
}

/* Haversine */
function distanceMeters(lat1, lon1, lat2, lon2){
  const R = 6371000;
  const toRad = (x)=>x*Math.PI/180;
  const dLat = toRad(lat2-lat1);
  const dLon = toRad(lon2-lon1);
  const a = Math.sin(dLat/2)**2 +
    Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  return 2*R*Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

/* ===================== Map ===================== */
let map, marker, accuracyCircle;

function initMap(){
  map = L.map("map", { zoomControl:true }).setView([48.65, 12.33], 15);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);

  marker = L.marker([48.65, 12.33]).addTo(map);
  accuracyCircle = L.circle([48.65, 12.33], { radius: 0 }).addTo(map);
}
initMap();

/* ===================== Storage: Visits ===================== */
let visits = [];
const VISITS_KEY = "vlog_orte_visits_v1";

function loadVisits(){
  try{
    visits = JSON.parse(localStorage.getItem(VISITS_KEY) || "[]");
    if(!Array.isArray(visits)) visits = [];
  }catch{ visits = []; }
}
function saveVisits(){
  localStorage.setItem(VISITS_KEY, JSON.stringify(visits));
}
function renderVisits(){
  if(!visits.length){
    $("visitsBox").innerHTML = `<span class="muted">Noch nichts gespeichert.</span>`;
    return;
  }
  const html = visits.slice(0,50).map(v=>{
    const d = new Date(v.time);
    const t = d.toLocaleString();
    const title = escapeHtml(v.title || "Ort");
    const coords = `${v.lat2
/* ===================== Wikipedia + OSM (Infos) ===================== */

async function reverseGeocode(lat, lon){
  try{
    const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}&zoom=14&addressdetails=1`;
    const r = await fetch(url, { headers: { "Accept":"application/json" }});
    if(!r.ok) throw new Error("Nominatim HTTP " + r.status);
    const j = await r.json();
    const a = j.address || {};

    const name =
      a.village || a.town || a.city || a.municipality || a.suburb || a.county || j.name || null;

    const parts=[];
    if(a.county && a.county!==name) parts.push(a.county);
    if(a.state) parts.push(a.state);
    if(a.country) parts.push(a.country);

    return { name, region: parts.length ? "‚Äì "+parts.join(", ") : "", raw: a };
  }catch(e){
    logDebug("‚ö†Ô∏è reverseGeocode Fehler: " + (e?.message || e));
    return { name:null, region:"", raw:null };
  }
}

async function wikiGeosearch(lat,lon,radius=1200,limit=20){
  try{
    const url = `https://de.wikipedia.org/w/api.php?action=query&list=geosearch&gscoord=${lat}|${lon}&gsradius=${radius}&gslimit=${limit}&format=json&origin=*`;
    const r = await fetch(url);
    if(!r.ok) throw new Error("Wikipedia geosearch HTTP " + r.status);
    const j = await r.json();
    return j?.query?.geosearch || [];
  }catch(e){
    logDebug("‚ö†Ô∏è wikiGeosearch Fehler: " + (e?.message || e));
    return [];
  }
}

async function wikiSummaryByTitle(title){
  try{
    const url = `https://de.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
    const r = await fetch(url, { headers: { "Accept":"application/json" }});
    if(!r.ok) throw new Error("Wiki summary HTTP " + r.status);
    const j = await r.json();

    const extract = (j.extract || "").trim();
    const pageUrl = j?.content_urls?.desktop?.page || "";
    return { title: j.title || title, extract, url: pageUrl };
  }catch(e){
    logDebug("‚ö†Ô∏è wikiSummaryByTitle Fehler ("+title+"): " + (e?.message || e));
    return null;
  }
}

async function wikiSummaryBySearch(queryTitle){
  try{
    const sUrl = `https://de.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(queryTitle)}&srlimit=1&format=json&origin=*`;
    const r = await fetch(sUrl);
    if(!r.ok) throw new Error("Wikipedia search HTTP " + r.status);
    const s = await r.json();
    const t = s?.query?.search?.[0]?.title;
    if(!t) return null;
    return await wikiSummaryByTitle(t);
  }catch(e){
    logDebug("‚ö†Ô∏è wikiSummaryBySearch Fehler ("+queryTitle+"): " + (e?.message || e));
    return null;
  }
}

/* Highlights aus OSM Overpass (schnell, aber kann manchmal blocken) */
async function getHighlights(lat,lon){
  try{
    const overpass = "https://overpass-api.de/api/interpreter";
    const q = `
      [out:json][timeout:12];
      (
        node(around:1200,${lat},${lon})["tourism"];
        node(around:1200,${lat},${lon})["historic"];
        node(around:1200,${lat},${lon})["amenity"="museum"];
        way(around:1200,${lat},${lon})["tourism"];
        way(around:1200,${lat},${lon})["historic"];
        way(around:1200,${lat},${lon})["amenity"="museum"];
      );
      out center 25;
    `;
    const r = await fetch(overpass, { method:"POST", body:q });
    if(!r.ok) throw new Error("Overpass HTTP " + r.status);
    const j = await r.json();
    const els = Array.isArray(j.elements) ? j.elements : [];
    const names = [];
    for(const e of els){
      const n = e.tags?.name;
      if(n && !names.includes(n)) names.push(n);
      if(names.length>=6) break;
    }
    return names;
  }catch(e){
    logDebug("‚ö†Ô∏è Highlights Fehler: " + (e?.message || e));
    return [];
  }
}

/* POI ausw√§hlen: m√∂glichst nah + interessant */
async function pickBestPoi(lat,lon){
  const list = await wikiGeosearch(lat,lon,1200,20);
  if(!list.length) return null;

  // Score: Distanz + Titel-L√§nge + "interessant" Keywords
  const kw = /(Burg|Schloss|Kirche|Br√ºcke|Tor|Denkmal|Museum|Kloster|Kathedrale|Dom|Platz|Rathaus|Altstadt|Festung)/i;

  let best = null;
  for(const it of list){
    const dist = Number(it.dist || 999999);
    let score = dist;
    if(kw.test(it.title)) score -= 250;
    if((it.title || "").length < 18) score -= 40;
    if(!best || score < best.score){
      best = { title: it.title, dist, score };
    }
  }
  return best;
}

/* UI bef√ºllen */
let currentInfo = {
  kind:"", title:"", url:"", extract:"",
  labelLine:"", poiDist:null, highlights:[],
  hooks:[], hookIndex:0
};

function setWikiLink(url){
  if(!url){
    $("wikiLink").textContent = "‚Äî";
    $("wikiLink").className = "muted";
    return;
  }
  $("wikiLink").innerHTML = `<a href="${url}" target="_blank" rel="noopener">√∂ffnen</a>`;
}

function setInfoUI(data){
  currentInfo = { ...currentInfo, ...data };

  $("infoIntro").textContent = "Infos geladen.";
  const h = (currentInfo.highlights && currentInfo.highlights.length)
    ? `<div class="small"><strong>In der N√§he:</strong><br>${currentInfo.highlights.map(x=>"‚Ä¢ "+escapeHtml(x)).join("<br>")}</div>`
    : `<div class="small muted">Keine Highlights aus OSM gefunden (nicht schlimm).</div>`;

  const extract = escapeHtml(currentInfo.extract || "");
  const label = escapeHtml(currentInfo.labelLine || "");

  $("infoBox").innerHTML = `
    <div><strong>${label || "üìå Ort"}</strong></div>
    ${currentInfo.poiDist!=null ? `<div class="small muted">Entfernung: ca. ${Math.round(currentInfo.poiDist)} m</div>` : ""}
    <div style="margin-top:8px;">${extract || "<span class='muted'>Keine Beschreibung gefunden.</span>"}</div>
    <div class="sep"></div>
    ${h}
  `;

  setWikiLink(currentInfo.url || "");

  const kind = currentInfo.kind;
  const title = currentInfo.title;
  const labelLine = currentInfo.labelLine;

  const labelForHooks = (kind==="poi")
    ? (title || "diesem Ort")
    : (labelLine?.replace(/^üìå\s*Ort:\s*/,"").replace(/^Ort:\s*/,"") || title || "hier");

  currentInfo.hooks = makeHooks(labelForHooks, kind);
  currentInfo.hookIndex = 0;

  $("btnHook").disabled = false;
  $("btnCopy").disabled = false;
  $("btnSaveSpot").disabled = false;

  updateScriptBox();
}

/* Der eigentliche Info-Fetch mit Fallback-Kaskade */
async function fetchPlaceInfo(force){
  if(!lastFix) return;

  const now = Date.now();
  if(!force && now - lastInfoFetchAt < 12000) return;
  lastInfoFetchAt = now;

  const {lat,lon,accuracy} = lastFix;

  if(!force && lastInfoLatLon){
    const d = distanceMeters(lastInfoLatLon.lat, lastInfoLatLon.lon, lat, lon);
    if(d < 250) return;
  }
  lastInfoLatLon = {lat,lon};

  setStatus("Suche Infos‚Ä¶", "warn");
  clearDebug();
  logDebug(`‚ÑπÔ∏è fetchPlaceInfo: acc=${Math.round(accuracy)}m lat=${lat.toFixed(5)} lon=${lon.toFixed(5)}`);

  // 1) POI Versuch
  try{
    const poi = await pickBestPoi(lat,lon);
    if(poi){
      logDebug(`‚úÖ POI gew√§hlt: ${poi.title} (${poi.dist}m)`);
      const sum = await wikiSummaryByTitle(poi.title);
      const highlights = await getHighlights(lat,lon);
      if(sum && (sum.extract || sum.title)){
        setInfoUI({
          kind: "poi",
          title: sum.title,
          url: sum.url,
          extract: sum.extract,
          labelLine: `üìç In der N√§he: ${sum.title}`,
          poiDist: poi.dist,
          highlights
        });
        setStatus("bereit", "ok");
        return;
      }
      logDebug("‚ö†Ô∏è POI Summary leer ‚Üí Fallback Ort");
    } else {
      logDebug("‚ÑπÔ∏è Kein starker POI ‚Üí Fallback Ort");
    }
  }catch(e){
    logDebug("‚ö†Ô∏è POI-Suche fehlgeschlagen ‚Üí Fallback Ort");
  }

  // 2) Orts-Fallback
  const place = await reverseGeocode(lat,lon);
  let placeName = place?.name;

  if(!placeName){
    placeName = "Postau";
    logDebug("‚ö†Ô∏è reverseGeocode lieferte keinen Ortsnamen ‚Üí Fallback: Postau");
  }

  let sum2 = await wikiSummaryBySearch(placeName);

  // 3) N√§chstgr√∂√üerer Bereich aus OSM
  if(!sum2 && place?.raw){
    const a = place.raw;
    const nextBigger = a.town || a.city || a.county || a.state || null;
    if(nextBigger && nextBigger !== placeName){
      logDebug(`‚ÑπÔ∏è Ort ohne Treffer ‚Üí n√§chstgr√∂√üerer Bereich: ${nextBigger}`);
      sum2 = await wikiSummaryBySearch(nextBigger);
      if(sum2) placeName = nextBigger;
    }
  }

  // 4) Letzter Notnagel
  if(!sum2){
    logDebug("‚ö†Ô∏è Ortssuche ohne Treffer ‚Üí Notnagel: Landshut");
    const s3 = await wikiSummaryBySearch("Landshut");
    if(s3){
      sum2 = s3;
      placeName = "Landshut";
    }
  }

  const highlights2 = await getHighlights(lat,lon);

  if(sum2){
    setInfoUI({
      kind: "place",
      title: sum2.title,
      url: sum2.url,
      extract: sum2.extract,
      labelLine: `üìå Ort: ${placeName} ${place?.region || ""}`.trim(),
      poiDist: null,
      highlights: highlights2
    });
  } else {
    setInfoUI({
      kind: "place",
      title: placeName,
      url: "",
      extract: "Leider keine passende Wikipedia-Kurzbeschreibung gefunden. (Passiert manchmal bei sehr kleinen Ortsteilen.)",
      labelLine: `üìå Ort: ${placeName} ${place?.region || ""}`.trim(),
      poiDist: null,
      highlights: highlights2
    });
  }

  setStatus("bereit", "ok");
}

/* Button: Infos holen */
function getCurrentOncePromise(){
  return new Promise((resolve, reject)=>{
    if(!navigator.geolocation) return reject(new Error("Geolocation nicht verf√ºgbar"));
    navigator.geolocation.getCurrentPosition(
      (pos)=>{ onFix(pos); resolve(pos); },
      (err)=>reject(err),
      { enableHighAccuracy:true, timeout:20000, maximumAge:0 }
    );
  });
}

$("btnInfo").addEventListener("click", async ()=>{
  try{
    if(!lastFix){
      setStatus("Hole Standort f√ºr Infos‚Ä¶", "warn");
      await getCurrentOncePromise();
    }
    await fetchPlaceInfo(true);
  }catch(e){
    setStatus("Infos nicht m√∂glich: Standort-Freigabe pr√ºfen", "bad");
    logDebug("‚ùå btnInfo Fehler: " + (e?.message || e));
    alert("Standort klappt nicht. Bitte Standort f√ºr diese Website erlauben (Browser-Einstellungen ‚Üí Website-Einstellungen ‚Üí Standort).");
  }
});
/* ===================== Vlog Script (30/60s) ===================== */

function makeHooks(placeLabel, kind){
  const p = placeLabel || "hier";
  const hooks = [
    `Wenn du denkst, ${p} ist nur ‚Äûganz normal‚Äú ‚Äì warte kurz‚Ä¶`,
    `Kurzer Stopp bei ${p}: Das hier hat mehr Geschichte, als man glaubt.`,
    `Das Spannende an ${p} ist nicht das, was man sofort sieht‚Ä¶`,
    `Heute zeig ich dir ${p} ‚Äì und warum das ein richtig guter Vlog-Spot ist.`,
    `Ich steh gerade bei ${p}. Und jetzt kommt der Teil, den kaum jemand kennt‚Ä¶`
  ];
  if(kind==="poi"){
    hooks.unshift(`Ich bin gerade direkt bei ${p} ‚Äì und das hier ist echt besonders.`);
  }
  return hooks;
}

function compactExtract(text, maxChars){
  const t = (text || "").replace(/\s+/g," ").trim();
  if(t.length <= maxChars) return t;
  return t.slice(0, maxChars).replace(/[,;:\s]+$/,"") + "‚Ä¶";
}

function buildVlogScript({ placeLabel, kind, extract, highlights, hookText, seconds }){
  const p = placeLabel || "diesem Ort";
  const hl = Array.isArray(highlights) ? highlights.slice(0,4) : [];
  const hasHL = hl.length>0;

  if(seconds <= 30){
    const info = compactExtract(extract, 260);
    const hlLine = hasHL ? `In der N√§he: ${hl.join(", ")}.` : "";
    return [
      hookText,
      "",
      `Ich bin gerade bei ${p}.`,
      info ? `Kurz dazu: ${info}` : `Kurz dazu: ${p} ist ein spannender Punkt in der Gegend.`,
      hlLine,
      "",
      `Wenn du hier mal vorbeikommst: kurz stehen bleiben, umschauen ‚Äì das lohnt sich.`
    ].filter(Boolean).join("\n");
  }

  // 60 Sekunden
  const info = compactExtract(extract, 520);
  const hlLines = hasHL
    ? ["Noch ein paar Spots in der N√§he:", ...hl.map(x=>`- ${x}`)]
    : ["Wenn du magst: Schau dich hier auch nach Infotafeln oder alten Fotos um ‚Äì das macht‚Äôs direkt lebendiger."];

  return [
    hookText,
    "",
    `Ich bin gerade bei ${p}.`,
    "",
    info ? `Warum das interessant ist: ${info}` : `Warum das interessant ist: ${p} hat eine Geschichte, die man nicht sofort sieht.`,
    "",
    ...hlLines,
    "",
    `Pro-Tipp f√ºrs Vloggen: Film erst eine Totale, dann Details (Schilder, Steine, Wappen, T√ºren) ‚Äì und erz√§hl genau diesen Mini-Fakt dazu.`,
  ].join("\n");
}

function updateScriptBox(){
  const seconds = Number($("lenSel").value || "30");
  const hookText =
    currentInfo.hooks?.[currentInfo.hookIndex] ||
    "Ich bin gerade hier ‚Äì und das ist ziemlich spannend.";

  const placeLabel =
    currentInfo.kind === "poi"
      ? (currentInfo.title || "diesem Ort")
      : (currentInfo.labelLine || currentInfo.title || "diesem Ort");

  const script = buildVlogScript({
    placeLabel,
    kind: currentInfo.kind,
    extract: currentInfo.extract,
    highlights: currentInfo.highlights,
    hookText,
    seconds
  });

  $("scriptBox").value = script;
}

function nextHook(){
  if(!currentInfo.hooks || !currentInfo.hooks.length) return;
  currentInfo.hookIndex = (currentInfo.hookIndex + 1) % currentInfo.hooks.length;
  updateScriptBox();
  setStatus("Hook gewechselt", "ok");
  setTimeout(()=>setStatus("bereit"), 900);
}

async function copyVlogScript(){
  const text = $("scriptBox").value.trim();
  if(!text){
    alert("Noch kein Skript vorhanden.");
    return;
  }
  try{
    await navigator.clipboard.writeText(text);
    setStatus("Skript kopiert ‚úÖ", "ok");
    setTimeout(()=>setStatus("bereit"), 1200);
  }catch{
    alert("Kopieren nicht m√∂glich ‚Äì bitte manuell markieren.");
  }
}

function saveCurrentSpot(){
  if(!lastFix){
    alert("Kein GPS-Fix vorhanden.");
    return;
  }
  visits.unshift({
    title: currentInfo.title || "Ort",
    url: currentInfo.url || "",
    lat: lastFix.lat,
    lon: lastFix.lon,
    time: Date.now()
  });
  visits = visits.slice(0, 400);
  saveVisits();
  renderVisits();
  setStatus("Ort gespeichert ‚úÖ", "ok");
  setTimeout(()=>setStatus("bereit"), 1200);
}

/* Buttons */
$("btnHook").addEventListener("click", nextHook);
$("btnCopy").addEventListener("click", copyVlogScript);
$("btnSaveSpot").addEventListener("click", saveCurrentSpot);
$("btnScript").addEventListener("click", updateScriptBox);
$("lenSel").addEventListener("change", updateScriptBox);

/* Initialer UI-Status */
$("btnInfo").disabled = false;      // Infos darf man immer holen
$("btnHook").disabled = true;
$("btnCopy").disabled = true;
$("btnSaveSpot").disabled = true;

/* Beim Laden einmal versuchen, Standort zu holen (nur wenn erlaubt) */
setTimeout(()=>{ try{ getCurrentOnce(); }catch{} }, 400);

setStatus("bereit", "ok");
</script>
</body>
</html>